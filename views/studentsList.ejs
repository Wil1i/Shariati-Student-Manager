<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("./templates/studentsList/head.ejs", {pageName: "لیست غایبین"}) %>
  </head>
  <body class="hold-transition sidebar-mini">

    <!-- Site wrapper -->
    <div class="wrapper">
      <!-- Preloader -->
      <div class="preloader flex-column justify-content-center align-items-center">
        <img class="animation__shake" src="/dist/img/AdminLTELogo.png" alt="AdminLTELogo" height="60" width="60">
      </div>

      <!-- Navbar -->
      <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button"
              ><i class="fas fa-bars"></i
            ></a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="/" class="nav-link">خانه</a>
          </li>
        </ul>

        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" data-widget="fullscreen" href="#" role="button">
              <i class="fas fa-expand-arrows-alt"></i>
            </a>
          </li>
        </ul>
      </nav>
      <!-- /.navbar -->

      <%- include("./templates/sideBar.ejs", {pageName : "لیست غایبین"}) %>

      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <div class="container-fluid">
            <div class="row mb-2">
              <div class="col-sm-6">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="/">خانه</a></li>
                  <li class="breadcrumb-item active">لیست غایبین</li>
                </ol>
              </div>
              <div class="col-sm-6">
                <h1 class="float-sm-right">لیست غایبین</h1>
              </div>
            </div>
          </div>
          <!-- /.container-fluid -->
        </section>

        <!-- Main content -->
        <section class="content">
          <!-- Default box -->
          <div class="card card-solid">
            <div class="card-body pb-0">
              <div class="row">

                <!-- qeybats -->
                <!-- ['Shayan', 'Ali', 'Mohammad'] -->
                <% qeybats.forEach((student) => { %>

                  <div
                  class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch flex-column"
                >
                  <div class="card bg-light d-flex flex-fill">
                    <div class="card-header text-muted border-bottom-0 lang-fa">
                      پایه یازدهم
                    </div>
                    <div class="card-body pt-0">
                      <div class="row">
                        <div class="col-5 text-center">
                          <img
                            src="../../dist/img/user1-128x128.jpg"
                            alt="user-avatar"
                            class="img-circle img-fluid"
                          />
                        </div>
                        <div class="col-7">
                          <h2 class="lead lang-fa"><b>شایان نصرآبادی</b></h2>
                          <p class="text-muted text-sm lang-fa">
                            <b>رشته: </b> کامپیوتر
                          </p>
                          <ul class="ml-4 mb-0 fa-ul text-muted">
                            <li class="small lang-fa dc-contacts">
                              <span class="fa-li"
                                ><i class="fas fa-lg fa-check"></i
                              ></span>
                              حاضر در این زنگ: بله
                            </li>
                            <li class="small lang-fa dc-contacts">
                              <span class="fa-li"
                                ><i class="fas fa-lg fa-phone"></i
                              ></span>
                              شماره تماس پدر: ۰۹۱۲۳۴۵۶۷۸۹
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="card-footer">
                      <div class="text-right">

                        <% if(student.noeQeybat == "qeyreMovajah"){ %>
                          <button href="#" class="btn btn-sm btn-success lang-fa movajahEvent" id="<%=student.id%>">
                            <i class="fas fa-check"></i> موجه کردن
                          </button>
                        <% }else{ %>
                          <p class="card-header-qeybat">غیبت موجه</p>
                        <% } %>

                        <a href="#" class="btn btn-sm btn-primary lang-fa">
                          <i class="fas fa-user"></i> مشاهده سوابق
                        </a>
                      </div>
                    </div>
                  </div>
                </div>


                <% }) %>
                
              </div>
            </div>
            <!-- /.card-footer -->
          </div>
          <!-- /.card -->
        </section>
        <!-- /.content -->
      </div>
      <!-- /.content-wrapper -->

      <!-- Control Sidebar -->
      <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
      </aside>
      <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- jQuery -->
    <script src="../../plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="../../dist/js/adminlte.min.js"></script>

    <script>
      var rightText = document.getElementsByClassName("text-right")
      var movajahButton = document.getElementsByClassName("movajahEvent")

      for(let i = 0; i < movajahButton.length; i++){

        movajahButton[i].addEventListener("click", async (e) => {
           const studentId = movajahButton[i].id
           await axios.post(`/students/list?action=movajah&id=${studentId}`).then(result => {

            if(result.status == 200){

              movajahButton[i].textContent = "غیبت موجه شد"

            }
           })
        })

      }      
    </script>
  </body>
</html>
